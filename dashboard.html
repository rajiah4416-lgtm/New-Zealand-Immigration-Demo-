<!DOCTYPE html>
<html lang="ga">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <title>Inimirce √âireann | Official Embassy Portal</title>
    <style>
        :root { --isd-green: #004d44; --ie-orange: #FF883E; --ie-green: #169B62; --bg: #f2f5f4; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); margin: 0; color: #333; }
        
        /* Embassy Header */
        header { background: #fff; padding: 10px 5%; border-bottom: 5px solid var(--isd-green); display: flex; justify-content: space-between; align-items: center; }
        .flag-box { display: flex; width: 45px; height: 25px; border: 1px solid #ccc; }
        .f-g { background: var(--ie-green); flex: 1; } .f-w { background: #fff; flex: 1; } .f-o { background: var(--ie-orange); flex: 1; }
        .isd-brand { color: var(--isd-green); font-weight: bold; text-align: center; font-size: 0.9rem; }

        .hero { background: var(--isd-green); color: white; padding: 15px; text-align: center; border-bottom: 3px solid var(--ie-orange); }
        
        /* Navigation Steps */
        .stepper { display: flex; justify-content: space-around; background: #fff; padding: 10px; font-size: 0.8rem; font-weight: bold; border-bottom: 1px solid #ddd; }
        .step { color: #999; cursor: pointer; padding: 5px 10px; }
        .step.active { color: var(--isd-green); border-bottom: 2px solid var(--isd-green); }

        .container { padding: 20px; max-width: 700px; margin: auto; }
        .page { display: none; background: white; padding: 25px; border-radius: 4px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
        .page.active { display: block; }

        label { display: block; font-weight: bold; margin: 10px 0 5px; color: var(--isd-green); font-size: 0.85rem; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box; margin-bottom: 10px; }
        .btn { background: var(--isd-green); color: white; border: none; width: 100%; padding: 15px; font-weight: bold; border-radius: 4px; cursor: pointer; text-transform: uppercase; margin-top: 10px; }
        
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th { background: #f8f9fa; padding: 12px; text-align: left; border-bottom: 2px solid var(--isd-green); font-size: 0.8rem; }
        td { padding: 12px; border-bottom: 1px solid #eee; font-size: 0.85rem; }
        .status { font-weight: bold; text-transform: uppercase; font-size: 0.75rem; }
    </style>
</head>
<body>

<header>
    <div class="flag-box"><div class="f-g"></div><div class="f-w"></div><div class="f-o"></div></div>
    <div class="isd-brand">AMBAS√ÅID NA h√âIREANN<br><small>EMBASSY OF IRELAND</small></div>
    <div id="liveClock" style="font-size: 11px; font-weight: bold; color: var(--isd-green);"></div>
</header>

<div class="hero">
    <h2 style="margin:0; font-size: 1.2rem;">Immigration Service Delivery (ISD)</h2>
</div>

<div class="stepper">
    <div id="s1" class="step active">1. ENTRY</div>
    <div id="s2" class="step">2. LIST</div>
    <div id="s3" class="step">3. INSPECT</div>
    <div id="s4" class="step">4. DOWNLOAD</div>
</div>

<div class="container">
    <div id="page1" class="page active">
        <h3 style="color: var(--isd-green); margin-top:0;">Client Registration</h3>
        <label>Full Name</label><input type="text" id="name" placeholder="Shoaib Muhammad">
        <label>Passport Number</label><input type="text" id="passport" placeholder="HN5199602">
        <label>Date of Birth</label><input type="date" id="dob">
        <label>Visa Category</label>
        <select id="visa">
            <option>Critical Skills Employment</option>
            <option>Study Visa (Stamp 2)</option>
            <option>General Employment Permit</option>
        </select>
        <label>Country</label>
        <select id="country">
            <option>Pakistan</option>
            <option>India</option>
            <option>Other</option>
        </select>
        <label>Decision Status</label>
        <select id="status">
            <option value="Waiting">Waiting</option>
            <option value="Approved">Approved</option>
            <option value="Refusal">Refusal</option>
        </select>
        <button class="btn" onclick="saveData()">Save Record & View List</button>
    </div>

    <div id="page2" class="page">
        <h3 style="color: var(--isd-green); margin-top:0;">Registry of Applications</h3>
        <table>
            <thead><tr><th>Name</th><th>Passport</th><th>Status</th><th>Select</th></tr></thead>
            <tbody id="listBody"></tbody>
        </table>
    </div>

    <div id="page3" class="page">
        <h3 style="color: var(--isd-green); margin-top:0;">Case Inspection</h3>
        <div id="inspectData" style="line-height: 2; border: 1px solid #ddd; padding: 20px; border-radius: 5px;"></div>
        <button class="btn" onclick="nav(4)">Proceed to Document Generation</button>
    </div>

    <div id="page4" class="page" style="text-align:center;">
        <h3 style="color: var(--isd-green);">Final Approval Document</h3>
        <p>The official letter is ready for secure download.</p>
        <div style="font-size: 50px; margin: 20px;">üìÑ</div>
        <button class="btn" onclick="downloadPDF()">DOWNLOAD OFFICIAL PDF</button>
        <button class="btn" style="background:#666;" onclick="nav(1)">NEW ENTRY</button>
    </div>
</div>

<script>
    function clock() {
        const opt = { timeZone: 'Europe/Dublin', hour: '2-digit', minute: '2-digit', second: '2-digit', day: 'numeric', month: 'short', year: 'numeric' };
        document.getElementById('liveClock').innerHTML = "DUBLIN: " + new Date().toLocaleString('en-IE', opt).toUpperCase();
    }
    setInterval(clock, 1000);

    let records = JSON.parse(localStorage.getItem('isd_4page_db')) || [];
    let selectedIdx = null;

    function nav(p) {
        document.querySelectorAll('.page').forEach(pg => pg.classList.remove('active'));
        document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
        document.getElementById('page'+p).classList.add('active');
        document.getElementById('s'+p).classList.add('active');
    }

    function saveData() {
        const record = {
            name: document.getElementById('name').value,
            pass: document.getElementById('passport').value,
            dob: document.getElementById('dob').value,
            visa: document.getElementById('visa').value,
            country: document.getElementById('country').value,
            status: document.getElementById('status').value,
            entryDate: new Date().toLocaleString('en-IE', { timeZone: 'Europe/Dublin' })
        };
        if(!record.name || !record.pass) return alert("Fill all fields");
        records.push(record);
        localStorage.setItem('isd_4page_db', JSON.stringify(records));
        updateList();
        nav(2);
    }

    function updateList() {
        const b = document.getElementById('listBody');
        b.innerHTML = '';
        records.forEach((r, i) => {
            b.innerHTML += `<tr>
                <td>${r.name}</td>
                <td>${r.pass}</td>
                <td class="status" style="color:${r.status==='Approved'?'green':r.status==='Refusal'?'red':'orange'}">${r.status}</td>
                <td><button onclick="inspect(${i})" style="cursor:pointer;">View</button></td>
            </tr>`;
        });
    }

    function inspect(i) {
        selectedIdx = i;
        const r = records[i];
        document.getElementById('inspectData').innerHTML = `
            <b>Name:</b> ${r.name}<br>
            <b>Passport:</b> ${r.pass}<br>
            <b>DOB:</b> ${r.dob}<br>
            <b>Category:</b> ${r.visa}<br>
            <b>Country:</b> ${r.country}<br>
            <b>Status:</b> ${r.status}<br>
            <b>Date Entered:</b> ${r.entryDate}
        `;
        nav(3);
    }

    function downloadPDF() {
        const r = records[selectedIdx];
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        doc.setFont("helvetica", "bold");
        doc.text("AMBAS√ÅID NA h√âIREANN", 105, 20, null, null, "center");
        doc.setFontSize(10);
        doc.text("EMBASSY OF IRELAND - VISA DIVISION", 105, 27, null, null, "center");
        
        doc.setFontSize(11); doc.setFont("helvetica", "normal");
        doc.text(`Date: ${new Date().toLocaleDateString()}`, 20, 50);
        doc.text(`To: ${r.name}`, 20, 60);
        doc.text(`Passport No: ${r.pass}`, 20, 67);
        
        doc.setFont("helvetica", "bold");
        doc.text(`Subject: Notification of Visa Decision - ${r.status.toUpperCase()}`, 20, 85);
        
        doc.setFont("helvetica", "normal");
        const msg = `Regarding your application for a ${r.visa}, the Immigration Service Delivery (ISD) has processed your request. Entry timestamp in our Dublin server: ${r.entryDate}.`;
        doc.text(doc.splitTextToSize(msg, 170), 20, 100);
        
        doc.text("Yours sincerely,", 20, 140);
        doc.text("Visa Officer,", 20, 150);
        doc.setFont("helvetica", "bold");
        doc.text("Immigration Service Delivery Ireland", 20, 155);

        doc.save(`${r.name}_ISD_Decision.pdf`);
    }

    updateList(); clock();
</script>
</body>
</html>
