<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NZ Immigration - Live PDF QR Suite</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --nz-blue: #00247d; --nz-silver: #c0c0c0; --nz-black: #1a1a1a; }
        body { font-family: 'Segoe UI', Helvetica, sans-serif; background: #0d1117; margin: 0; display: flex; color: white; }
        
        .sidebar { width: 400px; background: #161b22; padding: 25px; height: 100vh; overflow-y: auto; box-sizing: border-box; border-right: 4px solid var(--nz-blue); }
        .sidebar h2 { font-size: 13px; color: #58a6ff; text-transform: uppercase; border-bottom: 1px solid #30363d; padding-bottom: 8px; margin-top: 20px; }
        label { display: block; margin-top: 12px; font-size: 10px; text-transform: uppercase; color: #8b949e; }
        input, select { width: 100%; padding: 10px; margin-top: 5px; border-radius: 6px; border: 1px solid #30363d; background: #0d1117; color: white; font-size: 13px; }
        
        .upload-zone { 
            margin-top: 15px; padding: 20px; border: 2px dashed #58a6ff; border-radius: 8px; text-align: center; background: rgba(88, 166, 255, 0.05);
        }
        .link-status { font-size: 11px; margin-top: 10px; color: #2ecc71; display: none; }

        .preview-area { flex-grow: 1; padding: 40px; display: flex; justify-content: center; background: #0d1117; }
        .a4-page { 
            width: 210mm; min-height: 297mm; background: #fdfdfd; padding: 20mm; color: #1a1a1a;
            box-shadow: 0 0 40px rgba(0,0,0,0.5); position: relative; border-top: 10px solid var(--nz-black);
        }

        .header-box { text-align: center; border-bottom: 2px solid #000; padding-bottom: 20px; margin-bottom: 30px; }
        .official-seal { position: absolute; top: 40mm; right: 20mm; width: 100px; opacity: 0.1; transform: rotate(15deg); }

        .data-table { width: 100%; border-collapse: collapse; margin-bottom: 30px; }
        .data-table td { border: 1px solid #dee2e6; padding: 12px; font-size: 13px; }
        .label { background: #f8f9fa; font-weight: bold; width: 35%; color: var(--nz-blue); }

        .qr-verification-zone { 
            margin-top: 40px; border: 1px solid #ddd; padding: 25px; display: flex; align-items: center; gap: 30px; background: #fff;
            border-left: 10px solid var(--nz-blue);
        }
        .qr-desc h3 { margin: 0 0 10px 0; color: var(--nz-blue); font-size: 16px; }
        .qr-desc p { margin: 0; font-size: 12px; color: #555; line-height: 1.5; }

        .print-btn { 
            width: 100%; padding: 15px; margin-top: 25px; border: none; border-radius: 6px; 
            cursor: pointer; font-weight: bold; background: #238636; color: white; font-size: 15px; 
        }

        @media print { .sidebar { display: none; } .preview-area { padding: 0; } .a4-page { box-shadow: none; border: none; } }
    </style>
</head>
<body>

<div class="sidebar">
    <h2>üìÇ Step 1: Upload Client PDF</h2>
    <div class="upload-zone">
        <label style="color:#58a6ff; cursor:pointer;">
            <strong>Click to select PDF</strong>
            <input type="file" id="pdfFile" accept="application/pdf" style="display:none" onchange="handleFileUpload(event)">
        </label>
        <div id="fileInfo" style="font-size:10px; margin-top:5px; color:#8b949e;">No file selected</div>
    </div>
    <div id="uploadStatus" class="link-status">‚úì PDF Linked to QR Code</div>

    <h2>üë§ Step 2: Client Identity</h2>
    <label>Full Name</label>
    <input type="text" id="inName" placeholder="John Doe" oninput="sync()">
    <label>Passport No.</label>
    <input type="text" id="inPass" placeholder="PK000000" oninput="sync()">
    <label>Visa Reference #</label>
    <input type="text" id="inRef" placeholder="NZ-REF-2026" oninput="sync()">

    <h2>üè¢ Step 3: Employment</h2>
    <label>Sponsoring Company</label>
    <input type="text" id="inCo" placeholder="New Zealand Tech Ltd" oninput="sync()">
    <label>HR Manager</label>
    <input type="text" id="inHR" placeholder="Manager Name" oninput="sync()">

    <button class="print-btn" onclick="window.print()">Print Official Record</button>
</div>

<div class="preview-area">
    <div class="a4-page">
        <img src="https://upload.wikimedia.org/wikipedia/commons/d/df/Silver_fern_logo.svg" class="official-seal">
        
        <div class="header-box">
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_New_Zealand.svg" style="width: 80px; margin-bottom: 10px;">
            <h1 style="margin:0; font-size: 26px; letter-spacing: 1px;">IMMIGRATION NEW ZEALAND</h1>
            <p style="margin:5px 0; font-size: 12px; color: var(--nz-blue); font-weight: bold;">OFFICIAL SPONSORSHIP VERIFICATION</p>
        </div>

        <table class="data-table">
            <tr><td class="label">Full Legal Name</td><td class="outName">---</td></tr>
            <tr><td class="label">Passport Number</td><td class="outPass">---</td></tr>
            <tr><td class="label">Application Ref</td><td class="outRef" style="font-weight:bold;">---</td></tr>
            <tr><td class="label">Accredited Employer</td><td class="outCo">---</td></tr>
        </table>

        <div class="qr-verification-zone">
            <div id="mainQR"></div>
            <div class="qr-desc">
                <h3>SECURE DOCUMENT ACCESS</h3>
                <p>This QR code is a dynamic link to the applicant's uploaded PDF documentation and digital visa record. Authorized officers may scan to instantly view the original file.</p>
                <p style="margin-top:10px; font-weight:bold;">Verified by HR: <span class="outHR">---</span></p>
            </div>
        </div>

        <div style="margin-top: 60px; font-size: 10px; color: #888; border-top: 1px solid #eee; padding-top: 20px;">
            Notice: This document is electronically generated. For manual verification, please contact the New Zealand Immigration helpdesk or visit <strong>www.immigration.govt.nz</strong>.
        </div>
    </div>
</div>

<script>
    let qrcode = new QRCode(document.getElementById("mainQR"), { width: 140, height: 140, correctLevel: QRCode.CorrectLevel.H });
    let currentFileUrl = "";

    async function handleFileUpload(event) {
        const file = event.target.files[0];
        if (!file) return;

        document.getElementById('fileInfo').innerText = file.name;
        
        // For security and portability, we use a temporary placeholder.
        // In a real-world scenario, you would upload this to a server.
        // Here, we simulate the link generation.
        currentFileUrl = `https://nz-portal.verify/view/pdf/${encodeURIComponent(file.name)}?id=${Math.random().toString(36).substr(2, 9)}`;
        
        document.getElementById('uploadStatus').style.display = 'block';
        sync();
    }

    function sync() {
        const data = {
            outName: document.getElementById('inName').value || '---',
            outPass: document.getElementById('inPass').value || '---',
            outRef: document.getElementById('inRef').value || '---',
            outCo: document.getElementById('inCo').value || '---',
            outHR: document.getElementById('inHR').value || '---'
        };

        for (const [key, value] of Object.entries(data)) {
            document.querySelectorAll('.' + key).forEach(el => el.innerText = value);
        }

        // The QR code contains the PDF link and identity metadata
        const qrContent = currentFileUrl ? currentFileUrl : `VERIFY|REF:${data.outRef}|NAME:${data.outName}`;
        qrcode.makeCode(qrContent);
    }

    sync();
</script>
</body>
</html>
