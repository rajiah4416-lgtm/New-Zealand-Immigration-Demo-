<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
    <title>Dashboard - NZ Immigration</title>
</head>
<body>
    <header class="nz-header"><h1>NZ Immigration | <small>Client Management</small></h1></header>
    
    <div class="main-container">
        <div class="nz-card" style="margin-bottom: 30px;">
            <h3>Register New Client & Visa</h3>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
                <div>
                    <label class="nz-label">Full Name</label>
                    <input type="text" id="name" class="nz-input">
                    <label class="nz-label">Passport Number</label>
                    <input type="text" id="passport" class="nz-input">
                    <label class="nz-label">Date of Birth</label>
                    <input type="date" id="dob" class="nz-input">
                    <label class="nz-label">Gender</label>
                    <select id="gender" class="nz-input">
                        <option value="Male">Male</option>
                        <option value="Female">Female</option>
                    </select>
                </div>
                <div>
                    <label class="nz-label">Country</label>
                    <select id="country" class="nz-input">
                        <option value="Pakistan">Pakistan</option>
                        <option value="India">India</option>
                        <option value="Other">Other Countries</option>
                    </select>
                    <label class="nz-label">Visa Start Date</label>
                    <input type="date" id="vStart" class="nz-input">
                    <label class="nz-label">Visa Expiry Date</label>
                    <input type="date" id="vEnd" class="nz-input">
                    <label class="nz-label">Upload Visa Copy (PDF)</label>
                    <input type="file" id="pdfFile" class="nz-input" accept=".pdf">
                </div>
            </div>
            <button onclick="saveClient()" class="nz-btn nz-btn-save">Save & Sync Records</button>
        </div>

        <div class="nz-card">
            <h3>Active Client Database</h3>
            <table>
                <thead>
                    <tr><th>Name</th><th>Passport</th><th>Country</th><th>Expiry</th><th>Action</th></tr>
                </thead>
                <tbody id="tableBody"></tbody>
            </table>
        </div>
    </div>

    <script>
        let clients = JSON.parse(localStorage.getItem('nz_db')) || [];

        function saveClient() {
            const fileInput = document.getElementById('pdfFile');
            const data = {
                name: document.getElementById('name').value,
                pass: document.getElementById('passport').value,
                dob: document.getElementById('dob').value,
                gender: document.getElementById('gender').value,
                country: document.getElementById('country').value,
                start: document.getElementById('vStart').value,
                end: document.getElementById('vEnd').value,
                fileName: fileInput.files[0] ? fileInput.files[0].name : "Visa_Document.pdf"
            };
            clients.push(data);
            localStorage.setItem('nz_db', JSON.stringify(clients));
            render();
        }

        function render() {
            const body = document.getElementById('tableBody');
            body.innerHTML = '';
            clients.forEach((c, i) => {
                body.innerHTML += `<tr>
                    <td>${c.name}</td><td>${c.pass}</td><td>${c.country}</td><td>${c.end}</td>
                    <td><button class="nz-btn" style="padding:5px 10px; font-size:14px;" onclick="download(${i})">Check & Download PDF</button></td>
                </tr>`;
            });
        }

        function download(i) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            const c = clients[i];
            doc.setFontSize(22);
            doc.text("NEW ZEALAND IMMIGRATION RECORD", 15, 20);
            doc.autoTable({
                startY: 30,
                body: [
                    ['Client Name', c.name], ['Passport #', c.pass], ['DOB', c.dob],
                    ['Gender', c.gender], ['Country', c.country],
                    ['Visa Issued', c.start], ['Visa Expiry', c.end]
                ],
                theme: 'grid', headStyles: {fillColor: [11, 12, 12]}
            });
            // This downloads with the same name as the uploaded file
            doc.save(c.fileName);
        }
        render();
    </script>
</body>
</html>
