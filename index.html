<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --alb-red: #e41e20; }
        body { font-family: 'Arial', sans-serif; background: #f4f4f4; padding: 20px; }
        .setup-box { max-width: 850px; margin: auto; background: #fff; padding: 30px; border-top: 10px solid var(--alb-red); box-shadow: 0 5px 15px rgba(0,0,0,0.2); }
        .input-row { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-bottom: 15px; }
        label { display: block; font-size: 12px; font-weight: bold; margin-bottom: 5px; color: #333; }
        input, select { width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 4px; }
        .btn-ready { background: var(--alb-red); color: white; border: none; padding: 15px; width: 100%; cursor: pointer; font-weight: bold; font-size: 18px; border-radius: 5px; }
        #photo_frame { width: 120px; height: 150px; border: 1px solid #ddd; margin-top: 10px; display: block; object-fit: cover; }
    </style>
</head>
<body>

<div class="setup-box">
    <h2 style="text-align:center; margin-top:0;">REPUBLIKA E SHQIPËRISË</h2>
    <p style="text-align:center; color:red; font-weight:bold;">E-VISA SYSTEM (KARACHI MISSION)</p>
    <hr>

    <div class="input-row">
        <div>
            <label>Full Name (Surname, Name)</label>
            <input type="text" id="c_name" placeholder="مثال: ISMAIL, MUHAMMAD">
            <label>Passport Number</label>
            <input type="text" id="c_pass" placeholder="PA1234567">
            <label>Date of Birth</label>
            <input type="date" id="c_dob">
        </div>
        <div>
            <label>Application Number (Ref)</label>
            <input type="text" id="c_ref" placeholder="BUC-1302240902...">
            <label>Visa Issue Date</label>
            <input type="date" id="c_issue">
            <label>Nationality</label>
            <select id="c_nation"><option>Pakistan</option><option>India</option><option>Other</option></select>
        </div>
    </div>

    <div class="input-row">
        <div>
            <label>Visa Type</label>
            <input type="text" id="c_type" value="D">
        </div>
        <div>
            <label>Upload Photo</label>
            <input type="file" onchange="readPhoto(event)">
            <img id="photo_frame" src="" style="display:none;">
        </div>
    </div>

    <button class="btn-ready" onclick="buildVisaPDF()">ڈاؤن لوڈ کریں (Download E-Visa)</button>
</div>

<div id="qr_hidden" style="display:none;"></div>

<script>
    let userPhoto = "";
    function readPhoto(e) {
        const reader = new FileReader();
        reader.onload = () => { userPhoto = reader.result; document.getElementById('photo_frame').src=userPhoto; document.getElementById('photo_frame').style.display='block'; };
        reader.readAsDataURL(e.target.files[0]);
    }

    function buildVisaPDF() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        
        const info = {
            name: document.getElementById('c_name').value.toUpperCase(),
            ref: document.getElementById('c_ref').value,
            pass: document.getElementById('c_pass').value.toUpperCase(),
            dob: document.getElementById('c_dob').value,
            issue: document.getElementById('c_issue').value,
            type: document.getElementById('c_type').value,
            nation: document.getElementById('c_nation').value.toUpperCase()
        };

        // ڈیزائن کی ترتیب (Design Layout)
        doc.setLineWidth(0.5);
        doc.rect(5, 5, 200, 287); // Border
        doc.setFontSize(10);
        doc.text("Electronic-Visa REPUBLIC OF ALBANIA", 10, 15);
        doc.setFont("helvetica", "bold");
        doc.text(info.ref, 195, 15, {align: "right"});
        
        // سرخ ایگل لوگو کی جگہ
        doc.setFillColor(228, 30, 32);
        doc.rect(98, 10, 15, 15, 'F');
        doc.line(5, 30, 205, 30);

        // تصویر (Photo)
        if(userPhoto) doc.addImage(userPhoto, 'JPEG', 15, 40, 35, 45);
        else doc.rect(15, 40, 35, 45);

        // ڈیٹا فیلڈز (Data Fields)
        doc.setFontSize(8);
        doc.setFont("helvetica", "normal");
        const labels = [
            ["E VLEFSHME PER / VALID FOR", "ALBANIA"],
            ["NGA / FROM", info.issue],
            ["DERI / UNTIL", "ONE YEAR FROM ISSUE"],
            ["TIPI VIZES / TYPE OF VISA", info.type],
            ["NUMRI I PASAPORTES / PASSPORT NO.", info.pass],
            ["MBIEMER, EMER / SURNAME, NAME", info.name],
            ["LESHUAR NE / ISSUED IN", "KARACHI (via Istanbul Mission)"]
        ];

        labels.forEach((item, i) => {
            doc.text(item[0], 60, 45 + (i * 11));
            doc.setFont("helvetica", "bold");
            doc.text(item[1], 115, 45 + (i * 11));
            doc.setFont("helvetica", "normal");
        });

        // MRZ لائنز
        doc.setFont("courier", "bold");
        doc.setFontSize(11);
        doc.text(`P<ALB${info.name.split(',')[0]}<<${info.name.split(',')[1]}<<<<<<<<<<<<<<<<<<`, 10, 160);
        doc.text(`${info.pass}<<<${info.dob.replace(/-/g,'')}M3301236753003196<<<<08`, 10, 170);

        // QR Code
        const qDiv = document.getElementById("qr_hidden");
        qDiv.innerHTML = "";
        new QRCode(qDiv, { text: "ALB-VERIFY-" + info.ref, width: 120, height: 120 });

        setTimeout(() => {
            const canvas = qDiv.querySelector('canvas');
            if(canvas) doc.addImage(canvas.toDataURL("image/png"), 'PNG', 15, 230, 35, 35);
            doc.setFont("helvetica", "italic");
            doc.setFontSize(7);
            doc.text("Note: This document is generated and sealed by an automatic procedure.", 55, 250);
            doc.save(`Albania_Visa_${info.name}.pdf`);
        }, 500);
    }
</script>
</body>
</html>
