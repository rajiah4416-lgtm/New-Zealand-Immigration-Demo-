<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NZ Official Employment Agreement</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --nz-blue: #00247D; --nz-red: #CC142B; --text: #1a1a1a; }
        body { font-family: 'Times New Roman', serif; background: #444; margin: 0; padding: 20px; color: var(--text); }
        
        #ui-panel { background: white; max-width: 900px; margin: 0 auto 30px; padding: 25px; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.4); font-family: Arial, sans-serif; }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 12px; }
        input, select { padding: 8px; border: 1px solid #bbb; border-radius: 4px; width: 100%; box-sizing: border-box; }
        .btn-main { background: #0066cc; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; font-size: 16px; }
        
        #pdf-export { width: 210mm; margin: 0 auto; background: white; }
        .page { height: 297mm; width: 210mm; padding: 25mm 20mm; box-sizing: border-box; position: relative; page-break-after: always; line-height: 1.4; border-top: 20px solid var(--nz-blue); }
        
        .govt-header { text-align: center; border-bottom: 2px solid var(--nz-red); margin-bottom: 20px; padding-bottom: 10px; }
        .nz-flag { width: 110px; position: absolute; top: 25mm; right: 20mm; }
        .kia-ora { font-size: 28px; color: var(--nz-blue); font-weight: bold; margin: 15px 0; border-bottom: 1px solid #eee; }
        h3 { color: var(--nz-blue); border-left: 4px solid var(--nz-red); padding-left: 10px; margin-top: 20px; text-transform: uppercase; font-size: 14px; }
        p, li { font-size: 13px; text-align: justify; }

        table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        td { border: 1px solid #ccc; padding: 8px; font-size: 13px; }
        .label { background: #f2f2f2; font-weight: bold; width: 35%; }
        
        .signature-box { border: 1px solid #000; width: 100%; height: 100px; margin-top: 10px; background: #fff; }
        .sig-container { display: flex; justify-content: space-between; margin-top: 40px; }
        .sig-block { width: 45%; text-align: center; border-top: 1px solid #000; padding-top: 10px; }
    </style>
</head>
<body>

<div id="ui-panel">
    <h2 style="margin-top:0">ðŸ‡³ðŸ‡¿ NZ Labour Agreement Generator</h2>
    <div class="grid">
        <input type="text" id="c-name" placeholder="Client Full Name" oninput="sync()">
        <input type="text" id="c-passport" placeholder="Passport Number" oninput="sync()">
        <input type="date" id="c-dob" oninput="sync()">
        <input type="text" id="c-country" placeholder="Client Country" oninput="sync()">
        <input type="text" id="c-salary" placeholder="Salary (e.g. $31.50/hr)" oninput="sync()">
        <select id="c-cat" onchange="sync()">
            <option value="Restaurant Waiter">Restaurant Waiter</option>
            <option value="Cleaner Worker">Cleaner Worker</option>
            <option value="Mart Worker">Mart Worker</option>
            <option value="General Labourer">General Labourer</option>
        </select>
        <input type="text" id="co-name" placeholder="Company Name" oninput="sync()">
        <input type="text" id="co-num" placeholder="NZBN (Company No)" oninput="sync()">
        <input type="text" id="co-tax" placeholder="IRD (Tax No)" oninput="sync()">
        <input type="text" id="co-addr" placeholder="Company NZ Address" oninput="sync()">
    </div>
    
    <div style="margin-top:15px;">
        <label><b>Draw Client Signature:</b></label>
        <canvas id="signature-canvas" class="signature-box" style="border: 2px dashed #0066cc;"></canvas>
        <button onclick="signaturePad.clear()" style="padding:5px; margin-top:5px;">Clear Signature</button>
    </div>
    
    <button class="btn-main" onclick="download()">Generate & Download PDF</button>
</div>

<div id="pdf-export">
    <div class="page">
        <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_New_Zealand.svg" class="nz-flag">
        <div class="govt-header">
            <h1 style="margin:0; font-size: 24px;">IMMIGRATION NEW ZEALAND</h1>
            <p style="margin:0; font-weight:bold;">Te Ratonga Whakawhitiwhiti Kaimahi</p>
        </div>

        <div style="background:#f0f0f0; padding:10px; border:1px solid #000; margin-bottom:20px; font-weight: bold;">
            REF: <span id="out-ref" style="color:var(--nz-red)">NZ-GOV-772183</span>
        </div>

        <h3>1. LEGAL JURISDICTION</h3>
        <p>This agreement is governed by the laws of New Zealand. Both parties agree to the terms set out under the Employment Relations Act 2000.</p>

        <h3>2. EMPLOYER & APPLICANT DETAILS</h3>
        <table>
            <tr><td class="label">Employer Name</td><td id="out-co-name">---</td></tr>
            <tr><td class="label">NZBN / IRD</td><td><span id="out-co-num">---</span> / <span id="out-co-tax">---</span></td></tr>
            <tr><td class="label">Company Address</td><td id="out-co-addr">---</td></tr>
            <tr><td colspan="2" style="background:#eee; height:5px;"></td></tr>
            <tr><td class="label">Client Name</td><td id="out-name">---</td></tr>
            <tr><td class="label">Passport Number</td><td id="out-passport">---</td></tr>
            <tr><td class="label">Country of Origin</td><td id="out-country">---</td></tr>
        </table>
        
        <h3>3. POSITION DATA</h3>
        <p>The applicant is offered the role of <b><span id="out-cat">---</span></b>. This is a full-time position requiring 40 hours per week.</p>
    </div>

    <div class="page">
        <div class="kia-ora">KIA ORA, <span id="out-name2">---</span></div>
        <h3>4. REMUNERATION</h3>
        <p>Your base salary is <b><span id="out-salary">---</span></b>. Payment will be made weekly into a nominated NZ bank account.</p>

        <h3>5. ACCOMMODATION & FOOD</h3>
        <p>The employer agrees to facilitate suitable accommodation. Daily meal allowances or provisions are included as part of the foreign worker support package.</p>

        <h3>6. TRAVEL & INSURANCE</h3>
        <p>Airfare to Auckland/Wellington will be covered. All workers are protected by ACC (Accident Compensation Corporation) for workplace safety.</p>
    </div>

    <div class="page">
        <h3>7. EXECUTION & AUTHORIZATION</h3>
        <p>This document constitutes a binding agreement between the Employer and the Employee.</p>

        <div class="sig-container">
            <div class="sig-block">
                <img id="out-sig" style="width:180px; height:60px; object-fit:contain;">
                <p><b>Client Signature</b><br><small id="out-name3">---</small></p>
            </div>
            <div class="sig-block">
                <div style="height:60px; font-style:italic; font-family:serif; font-size:20px; color:darkblue; padding-top:10px;">
                    [DIRECTOR SIGNED]
                </div>
                <p><b>Authorized Employer</b><br><small>Hiring Manager / Director</small></p>
            </div>
        </div>

        <div style="margin-top:50px; display:flex; justify-content:space-between; align-items:center; border:2px solid #eee; padding:20px;">
            <div>
                <p style="margin:0; font-size:12px;"><b>SCAN TO VERIFY DOCUMENT</b></p>
                <p style="margin:0; font-size:10px; color:#666;">Ministry of Business, Innovation & Employment</p>
            </div>
            <div style="text-align:right;">
                <img id="out-qr" style="width:130px;">
                <p style="font-size:10px; margin:0;"><b id="out-ref2">NZ-GOV-772183</b></p>
            </div>
        </div>
    </div>
</div>

<script>
    const canvas = document.getElementById('signature-canvas');
    const signaturePad = new SignaturePad(canvas);
    
    // Generate Ref once so it doesn't change every keystroke
    const globalRef = "NZ-GOV-" + Math.floor(100000 + Math.random() * 900000);

    function sync() {
        const val = (id) => document.getElementById(id).value || '---';
        
        // Update PDF Text
        document.getElementById('out-name').innerText = val('c-name');
        document.getElementById('out-name2').innerText = val('c-name');
        document.getElementById('out-name3').innerText = val('c-name');
        document.getElementById('out-passport').innerText = val('c-passport');
        document.getElementById('out-country').innerText = val('c-country');
        document.getElementById('out-salary').innerText = val('c-salary');
        document.getElementById('out-cat').innerText = document.getElementById('c-cat').value;
        document.getElementById('out-co-name').innerText = val('co-name');
        document.getElementById('out-co-num').innerText = val('co-num');
        document.getElementById('out-co-tax').innerText = val('co-tax');
        document.getElementById('out-co-addr').innerText = val('co-addr');
        document.getElementById('out-ref').innerText = globalRef;
        document.getElementById('out-ref2').innerText = globalRef;
        
        // QR Code Data String
        const qrData = `NZ GOV VERIFIED DOCUMENT\n` +
                       `------------------------\n` +
                       `REF: ${globalRef}\n` +
                       `NAME: ${val('c-name')}\n` +
                       `PASSPORT: ${val('c-passport')}\n` +
                       `JOB: ${document.getElementById('c-cat').value}\n` +
                       `SALARY: ${val('c-salary')}\n` +
                       `EMPLOYER: ${val('co-name')}\n` +
                       `STATUS: LEGALLY BINDING`;

        const encodedData = encodeURIComponent(qrData);
        document.getElementById('out-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=150x150&data=${encodedData}`;
    }

    async function download() {
        if (!signaturePad.isEmpty()) {
            document.getElementById('out-sig').src = signaturePad.toDataURL();
        }
        
        const element = document.getElementById('pdf-export');
        const opt = {
            margin: 0,
            filename: `NZ_Agreement_${document.getElementById('c-name').value || 'Draft'}.pdf`,
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 3, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        html2pdf().set(opt).from(element).save();
    }

    // Initial Sync
    sync();
</script>

</body>
            </html>
