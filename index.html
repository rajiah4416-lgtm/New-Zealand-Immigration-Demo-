<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
    <style>
        :root { --alb-red: #e41e20; --alb-black: #000000; }
        body { font-family: 'Times New Roman', Times, serif; background: #f0f2f5; margin: 0; padding: 20px; }
        .card { max-width: 1000px; margin: auto; background: white; padding: 40px; border-top: 10px solid var(--alb-red); box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        header { display: flex; justify-content: space-between; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 20px; margin-bottom: 30px; }
        .grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 20px; }
        label { display: block; font-weight: bold; font-size: 0.75rem; margin-bottom: 5px; text-transform: uppercase; color: #444; }
        input, select { width: 100%; padding: 12px; border: 1px solid #ccc; border-radius: 4px; font-size: 0.9rem; }
        .btn-gen { background: var(--alb-red); color: white; border: none; padding: 18px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 30px; font-size: 1rem; border-radius: 4px; }
        #qr_buffer { display: none; }
        #photo_preview { width: 150px; height: 185px; border: 1px solid #000; object-fit: cover; margin-top: 10px; }
    </style>
</head>
<body>

<div class="card">
    <header>
        <div>
            <h1 style="margin:0; font-size: 1.5rem;">REPUBLIKA E SHQIPËRISË</h1>
            <p style="margin:5px 0; color: var(--alb-red); font-weight: bold;">E-VISA SYSTEM: KARACHI MISSION HUB</p>
        </div>
        <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/d/d7/Coat_of_arms_of_Albania.svg/1200px-Coat_of_arms_of_Albania.svg.png" style="height: 80px;">
    </header>

    <div class="grid">
        <div>
            <label>Full Name (SURNAME, Name)</label>
            <input type="text" id="name" placeholder="E.G. ALI, RAHAT">
            <label>Date of Birth</label>
            <input type="date" id="dob">
            <label>Nationality</label>
            <select id="nation"><option>PAKISTAN</option><option>INDIA</option><option>OTHER</option></select>
        </div>
        <div>
            <label>Passport Number</label>
            <input type="text" id="pass" placeholder="ZP1825791">
            <label>Visa Issue Date</label>
            <input type="date" id="i_date">
            <label>Application Reference</label>
            <input type="text" id="app_ref" placeholder="ABL906485OP7">
        </div>
        <div>
            <label>Visa Type</label>
            <select id="v_type"><option value="C">TYPE C</option><option value="D">TYPE D</option></select>
            <label>Applicant Photo</label>
            <input type="file" onchange="loadImg(event)">
            <img id="photo_preview" style="display:none;">
        </div>
    </div>
    <button class="btn-gen" onclick="generateVisa()">GENERATE OFFICIAL E-VISA PDF</button>
</div>

<div id="qr_buffer"></div>

<script>
    let imgStore = "";
    function loadImg(e) {
        const reader = new FileReader();
        reader.onload = () => { imgStore = reader.result; document.getElementById('photo_preview').src = imgStore; document.getElementById('photo_preview').style.display = 'block'; };
        reader.readAsDataURL(e.target.files[0]);
    }

    async function generateVisa() {
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF();
        const n = document.getElementById('name').value.toUpperCase();
        const p = document.getElementById('pass').value.toUpperCase();
        const r = document.getElementById('app_ref').value || "ABL" + Math.random().toString(36).substr(2, 9).toUpperCase();
        const d = document.getElementById('i_date').value;

        // Border and Header
        doc.setLineWidth(0.5); doc.rect(5, 5, 200, 287);
        doc.setFontSize(9); doc.text("Electronic-Visa REPUBLIC OF ALBANIA", 10, 15);
        doc.text("A100018340e", 195, 12, {align:"right"});
        doc.setFont("times", "bold"); doc.text(r, 195, 18, {align:"right"});

        // Red Eagle Emblem
        doc.setFillColor(228, 30, 32); doc.rect(98, 10, 15, 15, 'F');
        doc.line(5, 32, 205, 32);

        // Photo and Data Fields
        if(imgStore) doc.addImage(imgStore, 'JPEG', 15, 42, 38, 48);
        
        doc.setFontSize(8); doc.setFont("times", "normal");
        const rows = [
            ["E VLEFSHME PER / VALID FOR", "ALBANIA"],
            ["NGA / FROM", d],
            ["DERI / UNTIL", "ONE YEAR FROM ISSUE"],
            ["TIPI VIZES / TYPE OF VISA", document.getElementById('v_type').value],
            ["NUMRI I PASAPORTES / PASSPORT NO.", p],
            ["MBIEMER, EMER / SURNAME, NAME", n],
            ["LESHUAR NE / ISSUED IN", "KARACHI (Istanbul Consular Mission)"],
            ["SHENIME / REMARKS", "NONE"]
        ];

        rows.forEach((row, i) => {
            doc.setFont("times", "normal"); doc.text(row[0], 65, 45 + (i * 11));
            doc.setFont("times", "bold"); doc.text(row[1], 115, 45 + (i * 11));
        });

        // MRZ Zone
        doc.setFont("courier", "bold"); doc.setFontSize(11);
        const m1 = `P<ALB${n.replace(/ /g, "<")}<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<`.substring(0, 44);
        const m2 = `${p}<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<`.substring(0, 44);
        doc.text(m1, 10, 160); doc.text(m2, 10, 170);

        // QR Code
        const qb = document.getElementById("qr_buffer"); qb.innerHTML = "";
        new QRCode(qb, { text: "VERIFIED:" + r, width: 128, height: 128 });
        
        setTimeout(() => {
            const canv = qb.querySelector('canvas');
            if(canv) doc.addImage(canv.toDataURL("image/png"), 'PNG', 15, 235, 35, 35);
            doc.setFontSize(7); doc.setFont("times", "italic");
            doc.text("Note: This document is generated and sealed by an automatic procedure.", 55, 250);
            doc.save(`Albania_Evisa_${n}.pdf`);
        }, 500);
    }
</script>
</body>
</html>
