<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>NZ Labour Agreement System</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/signature_pad@4.0.0/dist/signature_pad.umd.min.js"></script>
    <style>
        :root { --nz-blue: #00247D; --nz-silver: #f2f2f2; --nz-red: #CC142B; }
        body { font-family: 'Arial', sans-serif; background: #333; margin: 0; padding: 20px; color: #333; }
        
        /* Control Panel */
        #ui-panel { background: white; max-width: 900px; margin: 0 auto 30px; padding: 25px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        .grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px; }
        input, select { padding: 10px; border: 1px solid #ccc; border-radius: 5px; width: 100%; box-sizing: border-box; }
        button { background: #0056b3; color: white; border: none; padding: 15px; border-radius: 5px; cursor: pointer; font-weight: bold; width: 100%; margin-top: 15px; }
        
        /* PDF Styling */
        #pdf-export { width: 210mm; margin: 0 auto; background: white; }
        .page { height: 297mm; width: 210mm; padding: 20mm; box-sizing: border-box; position: relative; page-break-after: always; border: 12px solid var(--nz-blue); border-top: 25px solid var(--nz-blue); }
        
        /* Branding */
        .header { display: flex; justify-content: space-between; align-items: center; border-bottom: 4px solid var(--nz-red); padding-bottom: 10px; }
        .nz-flag { width: 120px; }
        .kia-ora { font-family: 'Times New Roman'; font-size: 32px; color: var(--nz-blue); margin: 20px 0; font-weight: bold; }
        
        /* Tables */
        table { width: 100%; border-collapse: collapse; margin: 15px 0; }
        td { border: 1px solid #ddd; padding: 12px; font-size: 14px; }
        .bg-gray { background: #f9f9f9; font-weight: bold; width: 30%; }
        
        /* Signature Pad */
        #signature-canvas { border: 2px dashed #999; background: #fff; width: 100%; height: 150px; cursor: crosshair; }
        .qr-area { text-align: right; }
        .watermark { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotate(-45deg); font-size: 80px; color: rgba(0,0,0,0.03); pointer-events: none; z-index: 0; }
    </style>
</head>
<body>

<div id="ui-panel">
    <h2 style="margin-top:0">ðŸ‡³ðŸ‡¿ NZ Document Generator</h2>
    <div class="grid">
        <input type="text" id="c-name" placeholder="Client Full Name" oninput="sync()">
        <input type="text" id="c-passport" placeholder="Passport Number" oninput="sync()">
        <input type="date" id="c-dob" oninput="sync()">
        <input type="text" id="c-country" placeholder="Country" oninput="sync()">
        <input type="text" id="c-salary" placeholder="Salary (e.g. $29.50/hr)" oninput="sync()">
        <select id="c-cat" onchange="sync()">
            <option value="Restaurant Waiter">Restaurant Waiter</option>
            <option value="Cleaner Worker">Cleaner Worker</option>
            <option value="Mart Worker">Mart Worker</option>
        </select>
        <input type="text" id="co-name" placeholder="Company Name" oninput="sync()">
        <input type="text" id="co-num" placeholder="NZBN (Company No)" oninput="sync()">
        <input type="text" id="co-tax" placeholder="IRD (Tax No)" oninput="sync()">
    </div>
    
    <div style="margin-top:20px;">
        <label><b>Client Signature:</b></label>
        <canvas id="signature-canvas"></canvas>
        <button onclick="signaturePad.clear()" style="background:#666; width:auto; padding:5px 15px;">Clear Sign</button>
    </div>
    
    <button onclick="download()">Generate & Download 3-Page PDF</button>
</div>

<div id="pdf-export">
    <div class="page">
        <div class="watermark">OFFICIAL</div>
        <div class="header">
            <div>
                <h2 style="margin:0; color:var(--nz-blue)">NEW ZEALAND IMMIGRATION</h2>
                <small>MINISTRY OF BUSINESS, INNOVATION & EMPLOYMENT</small>
            </div>
            <img src="https://upload.wikimedia.org/wikipedia/commons/3/3e/Flag_of_New_Zealand.svg" class="nz-flag">
        </div>

        <div style="background:var(--nz-blue); color:white; padding:15px; margin-top:30px;">
            REFERENCE NO: <span id="out-ref">AUTO-GENERATING...</span>
        </div>

        <h3>1. AUTHORIZATION STATUS</h3>
        <p>Under the <i>Immigration Act 2009</i>, the applicant is hereby authorized for labor engagement under the sponsorship of the registered entity below.</p>
        
        <h3>2. REGISTERED EMPLOYER DETAILS</h3>
        <table>
            <tr><td class="bg-gray">Company Name</td><td id="out-co-name">---</td></tr>
            <tr><td class="bg-gray">Company Number</td><td id="out-co-num">---</td></tr>
            <tr><td class="bg-gray">IRD / Tax Number</td><td id="out-co-tax">---</td></tr>
            <tr><td class="bg-gray">Legal Jurisdiction</td><td>New Zealand Labour Law</td></tr>
        </table>
    </div>

    <div class="page">
        <div class="kia-ora">KIA ORA, <span id="out-name">---</span></div>
        <h2>Official Letter of Employment</h2>
        <p>We are pleased to confirm your appointment. You have been categorized under the following work stream:</p>
        
        <div style="border:2px solid var(--nz-blue); padding:15px; font-weight:bold; font-size:20px; text-align:center; color:var(--nz-red)">
            CATEGORY: <span id="out-cat">---</span>
        </div>

        <h3>3. COMPENSATION & HOURS</h3>
        <table>
            <tr><td class="bg-gray">Agreed Salary</td><td id="out-salary">---</td></tr>
            <tr><td class="bg-gray">Passport Holder</td><td id="out-passport">---</td></tr>
            <tr><td class="bg-gray">Date of Birth</td><td id="out-dob">---</td></tr>
            <tr><td class="bg-gray">Standard Hours</td><td>40 Hours / Week (As per NZ Law)</td></tr>
        </table>
        <p><i>Note: Overtime is calculated at 1.5x base rate in accordance with the Employment Relations Act.</i></p>
    </div>

    <div class="page">
        <h2>4. TERMS & PROVISIONS</h2>
        <p>This agreement includes the full sponsorship package as mandated by international recruitment standards:</p>
        <ul>
            <li><b>Ticket Company:</b> Full return airfare provided upon contract completion.</li>
            <li><b>Food Company:</b> Daily meal vouchers or onsite catering provided.</li>
            <li><b>Medical:</b> Comprehensive health cover through ACC New Zealand.</li>
            <li><b>Insurance:</b> Professional liability and life insurance included.</li>
        </ul>

        <h3>5. ACCEPTANCE</h3>
        <table style="margin-top:40px;">
            <tr>
                <td class="bg-gray">Join Date</td><td id="out-join">2026-03-01</td>
                <td class="bg-gray">Issue Date</td><td>2026-02-11</td>
            </tr>
        </table>

        <div style="margin-top:50px; display:flex; justify-content:space-between;">
            <div>
                <p><b>Client Signature:</b></p>
                <img id="out-sig" style="width:200px; border-bottom:1px solid #000;">
            </div>
            <div class="qr-area">
                <img id="out-qr" src="" style="width:100px;">
                <br><small id="out-ref2" style="font-size:8px;"></small>
            </div>
        </div>
        
        <div style="margin-top:100px; font-size:10px; color:#999; text-align:center;">
            This is a legally binding document protected by the New Zealand Crown.
        </div>
    </div>
</div>

<script>
    // Initialize Signature Pad
    const canvas = document.getElementById('signature-canvas');
    const signaturePad = new SignaturePad(canvas);

    function sync() {
        const name = document.getElementById('c-name').value || '---';
        const ref = "NZ-" + name.substring(0,3).toUpperCase() + "-" + Math.floor(1000 + Math.random() * 9000);
        
        document.getElementById('out-name').innerText = name;
        document.getElementById('out-passport').innerText = document.getElementById('c-passport').value || '---';
        document.getElementById('out-dob').innerText = document.getElementById('c-dob').value || '---';
        document.getElementById('out-salary').innerText = document.getElementById('c-salary').value || '---';
        document.getElementById('out-cat').innerText = document.getElementById('c-cat').value;
        document.getElementById('out-co-name').innerText = document.getElementById('co-name').value || '---';
        document.getElementById('out-co-num').innerText = document.getElementById('co-num').value || '---';
        document.getElementById('out-co-tax').innerText = document.getElementById('co-tax').value || '---';
        document.getElementById('out-ref').innerText = ref;
        document.getElementById('out-ref2').innerText = ref;
        
        // Update QR
        document.getElementById('out-qr').src = `https://api.qrserver.com/v1/create-qr-code/?size=100x100&data=${ref}-${name}`;
    }

    async function download() {
        // Transfer signature to PDF
        if (!signaturePad.isEmpty()) {
            document.getElementById('out-sig').src = signaturePad.toDataURL();
        }
        
        const element = document.getElementById('pdf-export');
        const opt = {
            margin: 0,
            filename: 'NZ_Employment_Agreement.pdf',
            image: { type: 'jpeg', quality: 1 },
            html2canvas: { scale: 2, useCORS: true },
            jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
        };
        
        html2pdf().set(opt).from(element).save();
    }

    // Initial Sync
    sync();
</script>

</body>
</html>
